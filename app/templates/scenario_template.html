<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ scenario.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
        <!-- Script to report XSS execution or non-execution -->
        <script>
            let xssReported = false;
            let notTriggeredTimeout = null;
            
            function reportTriggered() {
                if (xssReported) return; // Prevent double reporting
                xssReported = true;
                if (notTriggeredTimeout) clearTimeout(notTriggeredTimeout);
                
                fetch("{{ url_for('results_bp.report_xss', _external=True) }}?scenario_id={{ scenario.id }}&payload_id={{ payload.id if payload else 0 }}")
                    .then(r => console.log("XSS triggered reported"))
                    .catch(e => console.error("Triggered report failed", e));
            }
            
            function reportNotTriggered() {
                if (xssReported) return; // Prevent double reporting
                xssReported = true;
                
                fetch("{{ url_for('results_bp.report_not_triggered', _external=True) }}", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `scenario_id={{ scenario.id }}&payload_id={{ payload.id if payload else 0 }}`
                })
                .then(r => console.log("XSS not triggered reported"))
                .catch(e => console.error("Not triggered report failed", e));
            }
            
            // Main function to notify XSS detection
            function notifyXSS() {
                reportTriggered();
            }
            
            // Override console.log to detect "x" in arguments
            const originalConsoleLog = console.log;
            console.log = function(...args) {
                // Concatenate all arguments into a string
                const message = args.join(' ');
                // If there's the letter "x", trigger notifyXSS()
                if (message.includes('x')) {
                    reportTriggered();
                }
                // Call the real console.log
                originalConsoleLog.apply(console, args);
            };
            
            // Override window.alert to detect any alert
            const originalAlert = window.alert;
            window.alert = function(msg) {
                // Trigger reportTriggered() on any alert
                reportTriggered();
                
                // Call the real alert
                originalAlert(msg);
            };
            
            // Start the 3-second timer on page load
            window.addEventListener('DOMContentLoaded', function() {
                notTriggeredTimeout = setTimeout(reportNotTriggered, 2000);
            });
        </script>
    <h2>{{ scenario.name }}</h2>
    <p><strong>Description:</strong> {{ scenario.description }}</p>

    {% if "Scenario 1" in scenario.name %}
        <p>{{ payload.content|safe }}</p>
    {% elif "Scenario 2" in scenario.name %}
        <img src="#" onmouseover="{{ payload.content|safe }}">
    {% elif "Scenario 3" in scenario.name %}
        <script>
        {{ payload.content|safe }}
        </script>
    {% elif "Scenario 4" in scenario.name %}
        <input type="hidden" name="data" value="{{ payload.content|safe }}">
    {% elif "Scenario 5" in scenario.name %}
        <img src="{{ payload.content|safe }}">
    {% elif "Scenario 6" in scenario.name %}
        <a href="{{ payload.content|safe }}">Clique ici</a>
    {% elif "Scenario 7" in scenario.name %}
        <script src="{{ payload.content|safe }}"></script>
    {% elif "Scenario 8" in scenario.name %}
        <button onclick="{{ payload.content|safe }}">Click me</button>
    {% elif "Scenario 9" in scenario.name %}
        <textarea>{{ payload.content|safe }}</textarea>
    {% elif "Scenario 10" in scenario.name %}
        <!-- {{ payload.content|safe }} -->
    {% elif "Scenario 11" in scenario.name %}
        <script>
        var obj = {"callback": "{{ payload.content|safe }}"};
        </script>
    {% elif "Scenario 12" in scenario.name %}
        <select><option value="{{ payload.content|safe }}">Payload</option></select>
    {% elif "Scenario 13" in scenario.name %}
        <div style="{{ payload.content|safe }}">Styl√©</div>
    {% elif "Scenario 14" in scenario.name %}
        <meta http-equiv="refresh" content="1;url={{ payload.content|safe }}">
    {% elif "Scenario 15" in scenario.name %}
        <title>{{ payload.content|safe }}</title>
    {% elif "Scenario 16" in scenario.name %}
        <script>
        var msg = "{{ payload.content|safe }}";
        </script>
    {% elif "Scenario 17" in scenario.name %}
        <div data-info="{{ payload.content|safe }}">Element</div>
    {% elif "Scenario 18" in scenario.name %}
        <table><tr><td>{{ payload.content|safe }}</td></tr></table>
    {% elif "Scenario 19" in scenario.name %}
        <input placeholder="{{ payload.content|safe }}">
    {% elif "Scenario 20" in scenario.name %}
        <iframe src="{{ payload.content|safe }}"></iframe>
    {% endif %}


    
</body>
</html>
